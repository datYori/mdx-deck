import {
  Image,
} from 'mdx-deck'

<Image
  src='https://raw-labs.com/wp-content/themes/raw-labs/img/logo-raw.svg'
  style={{
    display: 'flex',
    alignItems: 'center',
    justifyContent: 'center',
    width: 250,
    height: 250
  }}>

</Image>

# Contained Pipelines

---

## Why

<Steps>

- Reproductible/Deterministic build and test env

- Isolated runs

- Easier host maintenance

</Steps>  

---

## Which

- CI Engine Tier1 Tests

- CI Engine Tier2 Scala Tests

- CI Repose

- CI Truffle Executor Scala Tests

- Docs CI/CD

- Scheduled master state

---

## Images

<Steps>

- raw-scala-runner:buster_jdk-11.0.16.8_hadoop3.3.0_spark3.1.1_scala2.12.15_sbt1.6.2
<sub>
<ul>
<li>CI Engine Tier1 Tests</li>
<li>CI ENgine Tier2 Scala Tests</li>
<li>CI Repose</li>
<li>Scheduled master state</li>
</ul>
</sub>

- raw-scala-runner:ol8_java17_gvm22.3.0_scala2.12.15_sbt1.6.2
<sub>
CI Truffle Executor Scala Tests
</sub>

- raw-docs:16-slim
<sub>
 Docs CI/CD
</sub>

</Steps>

---

## `raw-scala-runner` build

<Steps>

- `FROM raw-base-spark...` OR `FROM graalvm-ce...`

- we install `sbt` and `scala` -> `raw-sbt`

- we create a dedicated user with specific UID

- we load the `engine` folder and run an `sbt` command to cache deps

</Steps>

---

## `raw-scala-runner` usage

<Steps>

- we pre-pull latest stable version on OnPrem/EC2 minions

- we run as non-root user

- we re-build the necessary layer if any major `deps/*.version` changes as `init` step of CI pipeline

</Steps>

---

## Next

<Steps>

- Concurrent run for OnPrem

- One CI solution to rule them all

- Base Images refactoring/optimizations

- Easy major `deps/*.version` update


</Steps>

---

## MISC infos

<Steps>

- `raw-postgres` side container

- all `raw-*` images have their own CI/CD

- we use private `ghcr.io` to host those images

</Steps>

---

## Questions

<Steps>

- just-ask ;)

</Steps>